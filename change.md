# Leaf ç‰ˆæœ¬å‡çº§è®°å½• - 1.21.8 â†’ 1.21.10

## ğŸ“‹ å˜æ›´æ¦‚è¿°
å°† Leaf æ ¸å¿ƒç‰ˆæœ¬ä» 1.21.8 å‡çº§åˆ° 1.21.10ï¼ŒåŸºäºæœ€æ–°çš„ Paper 1.21.10 æ„å»ºï¼Œå¹¶è¿ç§» CI/CD ç³»ç»Ÿä» GitHub Actions åˆ° GitLab CI/CDã€‚

## ğŸ”§ ä¸»è¦å˜æ›´

### 1. æ ¸å¿ƒç‰ˆæœ¬é…ç½®
- **gradle.properties**: 
  - `mcVersion`: `1.21.8` â†’ `1.21.10`
  - `version`: `1.21.8-R0.1-SNAPSHOT` â†’ `1.21.10-R0.1-SNAPSHOT`
  - `paperCommit`: `29c8822d90899c89d2689338e81a98f690bcba12` â†’ `3e2564947162ad0a00ba9224c1954192e657bbe6`

### 2. æ–‡æ¡£æ›´æ–°
- **README.md**: æ›´æ–° Maven/Gradle ä¾èµ–ç‰ˆæœ¬ç¤ºä¾‹
- **public/readme/README_CN.md**: æ›´æ–°ä¸­æ–‡æ–‡æ¡£ä¸­çš„ç‰ˆæœ¬å¼•ç”¨

### 3. æ„å»ºè„šæœ¬
- **scripts/upstreamCommit.sh**: æ›´æ–° Paper å’Œ Purpur ä¸Šæ¸¸ç‰ˆæœ¬åˆ†æ”¯å¼•ç”¨
- **scripts/prepareRelease.sh**: æ›´æ–° JAR æ–‡ä»¶åå’Œæ ‡ç­¾ç‰ˆæœ¬

### 4. GitHub Actions å·¥ä½œæµ (å·²åºŸå¼ƒ)
- **.github/workflows/build-1218.yml**: 
  - å·¥ä½œæµåç§°æ›´æ–°ä¸º "Build Leaf 1.21.10"
  - åˆ†æ”¯å¼•ç”¨æ›´æ–°ä¸º `ver/1.21.10`
  - æ„å»ºäº§ç‰©åç§°å’Œè·¯å¾„æ›´æ–°
  - å‘å¸ƒæ ‡ç­¾å’Œæ–‡ä»¶åæ›´æ–°
- **.github/workflows/build-pr.yml**: æ›´æ–° PR æ„å»ºåˆ†æ”¯å’Œäº§ç‰©åç§°
- **.github/workflows/publish-api.yml**: æ›´æ–° API å‘å¸ƒåˆ†æ”¯

### 5. æ„å»ºé…ç½®
- **leaf-server/build.gradle.kts.patch**: æ›´æ–° mache ç‰ˆæœ¬åˆ° `1.21.10+build.2`

### 6. CI/CD ç³»ç»Ÿè¿ç§» - GitHub Actions â†’ GitLab CI/CD
- **æ–°å¢**: `.gitlab-ci.yml` - GitLab CI/CD ä¸»é…ç½®æ–‡ä»¶
- **æ–°å¢**: `docs/gitlab-ci-setup.md` - GitLab CI/CD é…ç½®æŒ‡å—
- **é…ç½®**: ä½¿ç”¨ GitLab è‡ªå¸¦çš„ Package Registry ä½œä¸º Maven ä»“åº“
- **åˆ†æ”¯ç­–ç•¥**: CI/CD è¿è¡Œåˆ†æ”¯è®¾ç½®ä¸º `main`

#### GitLab CI/CD æµæ°´çº¿é…ç½®
**é˜¶æ®µè®¾è®¡**:
1. **Build**: åº”ç”¨è¡¥ä¸å¹¶æ„å»ºé¡¹ç›®
2. **Test**: ä»£ç è´¨é‡æ£€æŸ¥å’Œå®‰å…¨æ‰«æ
3. **Package**: åˆ›å»ºæœ€ç»ˆçš„ Paperclip JAR
4. **Deploy**: å‘å¸ƒ API å’Œåˆ›å»º Release

**ä¸»è¦ä½œä¸š**:
- `build`: ä¸»æ„å»ºä½œä¸šï¼Œæ”¯æŒå¤±è´¥é‡è¯•
- `code-quality`: ä»£ç è´¨é‡æ£€æŸ¥å’Œæµ‹è¯•æŠ¥å‘Š
- `security-scan`: ä¾èµ–å®‰å…¨æ‰«æ
- `package`: åˆ›å»º Paperclip JAR æ–‡ä»¶
- `publish-api`: å‘å¸ƒåˆ° Maven ä»“åº“
- `release`: åˆ›å»º GitLab Release

**æŠ€æœ¯ç‰¹æ€§**:
- **Docker é•œåƒ**: `eclipse-temurin:21-jdk`
- **ç¼“å­˜ç­–ç•¥**: Gradle wrapper å’Œç¼“å­˜ç›®å½•
- **äº§ç‰©ç®¡ç†**: 7-30 å¤©è¿‡æœŸç­–ç•¥
- **æ¡ä»¶æ‰§è¡Œ**: åŸºäºä¸»åˆ†æ”¯ã€æ ‡ç­¾å’Œæäº¤æ¶ˆæ¯
- **å¤±è´¥é‡è¯•**: è‡ªåŠ¨æ¸…ç†ç¼“å­˜é‡è¯•æ„å»º

## ğŸ¯ Paper 1.21.10 æ–°ç‰¹æ€§
åŸºäº Paper 1.21.10 æ„å»º #129 (commit: 3e25649)ï¼ŒåŒ…å«ä»¥ä¸‹ä¿®å¤ï¼š
- ä¿®å¤ `allowEnteringNetherUsingPortals` æ¸¸æˆè§„åˆ™ä¸è¢«éµå®ˆçš„é—®é¢˜ (#13263)
- ä¿®å¤é“œç®±çš„ `isInteractable` é—®é¢˜ (#13325)
- ä¿®å¤ SwellGoal ä¸­çš„åå‘é€»è¾‘ (MC-179072) (#13396)
- ä¿®å¤å®ä½“ç«ç„°è¦†ç›–ä¿å­˜é—®é¢˜ (#13320)
- ä¿®å¤ Rotations ä¸­çš„åå‘æ£€æŸ¥ (#13399)
- å…¶ä»–æ€§èƒ½ä¼˜åŒ–å’Œé”™è¯¯ä¿®å¤

## âš ï¸ æŠ€æœ¯é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆ

### é—®é¢˜1: Paperweight Commit Hash è·å–å¤±è´¥
**ç°è±¡**: `git fetch origin <commit>` å¤±è´¥ï¼Œè¿”å› 128 é€€å‡ºç 
**åŸå› **: 
1. åˆå§‹ä½¿ç”¨çš„ commit hash ä¸å®Œæ•´æˆ–æ ¼å¼é”™è¯¯
2. æœ¬åœ° Paper æºç çš„ commit hash ä¸è¿œç¨‹ä»“åº“ä¸åŒ¹é…

**è§£å†³æ–¹æ¡ˆ**:
1. é€šè¿‡ Paper API è·å–æ­£ç¡®çš„æ„å»ºä¿¡æ¯
2. ä½¿ç”¨ `git ls-remote` è·å–è¿œç¨‹ä»“åº“çš„å®é™… commit hash
3. æœ€ç»ˆä½¿ç”¨å®˜æ–¹ Paper 1.21.10 åˆ†æ”¯çš„ commit: `3e2564947162ad0a00ba9224c1954192e657bbe6`

### é—®é¢˜2: æœ¬åœ°æºç ä¸è¿œç¨‹ä»“åº“ä¸åŒæ­¥
**ç°è±¡**: æœ¬åœ° paper-api å’Œ paper-server ç›®å½•å­˜åœ¨ï¼Œä½† commit hash ä¸è¿œç¨‹ä¸åŒ¹é…
**è§£å†³æ–¹æ¡ˆ**: ä½¿ç”¨è¿œç¨‹ä»“åº“çš„å®˜æ–¹ commit hashï¼Œè®© Paperweight è‡ªåŠ¨å¤„ç†æºç åŒæ­¥

## ğŸ”„ CI/CD è¿ç§»ä¼˜åŠ¿

### GitHub Actions vs GitLab CI/CD
| åŠŸèƒ½ | GitHub Actions | GitLab CI/CD |
|------|----------------|--------------|
| é…ç½®æ–‡ä»¶ | `.github/workflows/*.yml` | `.gitlab-ci.yml` |
| å…è´¹é¢åº¦ | 2000 åˆ†é’Ÿ/æœˆ | 400 åˆ†é’Ÿ/æœˆ (ä½†åŠŸèƒ½æ›´ä¸°å¯Œ) |
| é›†æˆåº¦ | éœ€è¦ç¬¬ä¸‰æ–¹å·¥å…· | åŸç”Ÿé›†æˆ |
| å®‰å…¨æ‰«æ | éœ€è¦é¢å¤–é…ç½® | å†…ç½®æ”¯æŒ |
| äº§ç‰©ç®¡ç† | 90 å¤© | å¯è‡ªå®šä¹‰ |

### è¿ç§»ä¼˜åŠ¿
- **é›†æˆåº¦æ›´é«˜**: ä¸ GitLab ä»“åº“æ·±åº¦é›†æˆ
- **åŠŸèƒ½æ›´ä¸°å¯Œ**: å†…ç½®å®‰å…¨æ‰«æã€ä»£ç è´¨é‡æ£€æŸ¥
- **ç®¡ç†æ›´ç®€å•**: å•ä¸€å¹³å°ç®¡ç†ä»£ç å’Œ CI/CD
- **Maven ä»“åº“**: ä½¿ç”¨ GitLab è‡ªå¸¦çš„ Package Registryï¼Œæ— éœ€å¤–éƒ¨è®¤è¯
- **åˆ†æ”¯ç­–ç•¥**: ç®€åŒ–ä¸ºä¸»åˆ†æ”¯ (`main`) è§¦å‘ï¼Œæ›´ç¬¦åˆç°ä»£å¼€å‘æµç¨‹
- **æŠ¥å‘Šæ›´è¯¦ç»†**: è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•ã€è¦†ç›–ç‡ã€å®‰å…¨æŠ¥å‘Š

## âš ï¸ å…¼å®¹æ€§è¯´æ˜
- **æ’ä»¶å…¼å®¹æ€§**: ä¿æŒä¸ç°æœ‰ Spigot/Paper æ’ä»¶çš„å®Œå…¨å…¼å®¹æ€§
- **é…ç½®å…¼å®¹æ€§**: ç°æœ‰é…ç½®æ–‡ä»¶æ— éœ€ä¿®æ”¹
- **API å…¼å®¹æ€§**: ä¿æŒ Leaf API çš„å‘åå…¼å®¹æ€§
- **Java ç‰ˆæœ¬**: ç»§ç»­ä½¿ç”¨ Java 21 LTS

## ğŸš€ å‡çº§å»ºè®®
1. **å¤‡ä»½**: å‡çº§å‰è¯·åŠ¡å¿…å¤‡ä»½æœåŠ¡å™¨æ•°æ®å’Œé…ç½®
2. **æµ‹è¯•**: åœ¨æµ‹è¯•ç¯å¢ƒä¸­éªŒè¯æ’ä»¶å…¼å®¹æ€§
3. **ç›‘æ§**: å‡çº§åç›‘æ§æœåŠ¡å™¨æ€§èƒ½å’Œç¨³å®šæ€§
4. **å›æ»š**: å¦‚é‡é—®é¢˜å¯å›æ»šåˆ° 1.21.8 ç‰ˆæœ¬

## ğŸ”§ GitLab CI/CD é…ç½®è¦æ±‚

### å¿…éœ€çš„ GitLab å˜é‡
```bash
# Maven ä»“åº“è®¤è¯ (Settings > CI/CD > Variables)
REPO_USER=<maven_repository_username>
REPO_PASSWORD=<maven_repository_password>
```

### å¯é€‰é…ç½®
```bash
# è‡ªå®šä¹‰æ„å»ºå‚æ•°
GRADLE_OPTS="-Dorg.gradle.daemon=false -Dorg.gradle.caching=true"
JAVA_VERSION="21"
MC_VERSION="1.21.10"
```

## ğŸ“ åç»­å·¥ä½œ
- [x] æ›´æ–°ç‰ˆæœ¬é…ç½®æ–‡ä»¶
- [x] æ›´æ–°æ–‡æ¡£å’Œè„šæœ¬
- [x] è§£å†³ Paperweight commit hash é—®é¢˜
- [x] åˆ›å»º GitLab CI/CD é…ç½®
- [x] é…ç½® GitLab Package Registry
- [x] è®¾ç½®ä¸»åˆ†æ”¯ CI/CD è§¦å‘
- [x] ç¼–å†™ GitLab CI/CD æ–‡æ¡£
- [ ] æµ‹è¯• GitLab CI/CD æµæ°´çº¿
- [ ] éªŒè¯æ‰€æœ‰è¡¥ä¸æ–‡ä»¶å…¼å®¹æ€§
- [ ] æµ‹è¯• GitLab Maven ä»“åº“å‘å¸ƒ
- [ ] æ›´æ–°å‘å¸ƒè¯´æ˜
- [ ] ç¤¾åŒºå…¬å‘Šå’Œè¿ç§»æŒ‡å—

## ğŸ”§ æ„å»ºçŠ¶æ€
**å½“å‰çŠ¶æ€**: GitHub Actions + GitHub Packages é…ç½®å®Œæˆ
**ä»“åº“åœ°å€**: https://github.com/chuyuewei/TRLCore
**Paper Commit**: `8e5e54f5664c19096ec1a3040dc038bab4fb306b` (å®˜æ–¹ 1.21.11 åˆ†æ”¯)
**CI/CD ç³»ç»Ÿ**: GitHub Actions
**Maven ä»“åº“**: GitHub Packages (`https://maven.pkg.github.com/chuyuewei/TRLCore`)
**è§¦å‘åˆ†æ”¯**: `main`

## ğŸ”„ CI/CD é…ç½® - GitHub Actions

### å·¥ä½œæµæ–‡ä»¶
- `.github/workflows/build.yml` - æ„å»ºå·¥ä½œæµ
- `.github/workflows/release.yml` - å‘å¸ƒå·¥ä½œæµ
- `.github/workflows/publish.yml` - Maven å‘å¸ƒå·¥ä½œæµ

### è§¦å‘æ¡ä»¶
- **Build**: æ¨é€åˆ° `main`ã€Pull Requestã€æ‰‹åŠ¨è§¦å‘
- **Release**: åˆ›å»ºæ ‡ç­¾ (`v*`)ã€æ‰‹åŠ¨è§¦å‘
- **Publish**: æ¨é€åˆ° `main`ã€æ‰‹åŠ¨è§¦å‘

### Maven ä»“åº“
ä½¿ç”¨ GitHub Packages ä½œä¸º Maven ä»“åº“ï¼Œæ— éœ€é¢å¤–é…ç½®å¤–éƒ¨ä»“åº“ã€‚

---
**å˜æ›´æ—¶é—´**: 2025-01-20  
**å˜æ›´äººå‘˜**: AI Assistant  
**å½±å“èŒƒå›´**: å…¨é¡¹ç›®ç‰ˆæœ¬å‡çº§ + CI/CD ç³»ç»Ÿè¿ç§»